<!DOCTYPE HTML><html lang="zh-hans"><head><meta charset="UTF-8"><meta content="text/html; charset=utf-8"http-equiv="Content-Type"><title>Using async</title><meta content="IE=edge"http-equiv="X-UA-Compatible"/><meta content="
  
"name="description"><meta content="GitBook 3.2.3"name="generator"><meta content="QuickApp.cn"name="author"><link href="../../gitbook/style.css"rel="stylesheet"><link href="../../gitbook/gitbook-plugin-search-pro/search.css"rel="stylesheet"><link href="../../gitbook/gitbook-plugin-highlight-hap/website.css"rel="stylesheet"><link href="../../gitbook/gitbook-plugin-anchor-navigation-ex/style/plugin.css"rel="stylesheet"><link href="../../styles/website.css"rel="stylesheet"><meta content="no-cache"http-equiv="Pragma"/><meta content="no-cache"http-equiv="Cache-Control"/><meta content="0"http-equiv="Expires"/><meta content="true"name="HandheldFriendly"/><meta content="width=device-width,initial-scale=1,user-scalable=no"name="viewport"><meta content="yes"name="apple-mobile-web-app-capable"><meta content="black"name="apple-mobile-web-app-status-bar-style"><link href="../../gitbook/images/apple-touch-icon-precomposed-152.png"rel="apple-touch-icon-precomposed"sizes="152x152"><link href="../../gitbook/images/favicon.ico"rel="shortcut icon"type="image/x-icon"><link href="../widgets/index.en.md"rel="next"/><link href="parent-child-component-communication.en.html"rel="prev"/><link href="../widgets/index.en.md"rel="next"/><link href="parent-child-component-communication.en.html"rel="prev"/></head><body><header class="doc-header"><a href="javascript:;"class="btn doc-menu-toggle"aria-label=""><i class="fa fa-bars"aria-hidden="true"></i></a><div class="doc-logo"><a target="_blank"style="font-size:150%"title="quickapp">QuickApp</a></div><div class="doc-nav"><a href="../../"class="current">Tutorial</a> <a href="../../framework/index.en.html">Framework</a> <a href="../../widgets/common-events.en.html">Widgets</a> <a href="../../features/index.en.html">Features</a></div><div class="doc-search-bar"><div id="book-search-input"><i class="fa fa-search icon-search"aria-hidden="true"></i> <input placeholder="关键字搜索"type="text"></div></div></header><div class="doc-container"><nav class="doc-menu"role="navigation"><ul class="summary"><li class="open chapter"data-level="1.1.1.1"><a href="javascript:;">Get started <span class="icon icon-arrow"></span></a><ul class="articles"><li class="open chapter"data-level="1.1.1.1.1"data-path="../../"><a href="../../">Overview</a></li><li class="open chapter"data-level="1.1.1.1.2"data-path="../getting-started/build-environment.en.html"><a href="../getting-started/build-environment.en.html">Build environment</a></li><li class="open chapter"data-level="1.1.1.1.3"data-path="../getting-started/creating-and-building.en.html"><a href="../getting-started/creating-and-building.en.html">Creating and building</a></li><li class="open chapter"data-level="1.1.1.1.4"data-path="../getting-started/development-and-debugging.en.html"><a href="../getting-started/development-and-debugging.en.html">Development and debugging</a></li><li class="open chapter"data-level="1.1.1.1.5"data-path="../getting-started/installing.en.html"><a href="../getting-started/installing.en.html">Installing on device</a></li><li class="open chapter"data-level="1.1.1.1.6"data-path="../getting-started/releasing.en.html"><a href="../getting-started/releasing.en.html">Releasing</a></li><li class="open chapter"data-level="1.1.1.1.7"data-path="../getting-started/project-configuration.en.html"><a href="../getting-started/project-configuration.en.html">Project configuration</a></li></ul></li><li class="open open chapter"data-level="1.1.1.2"><a href="javascript:;">Framework <span class="icon icon-arrow"></span></a><ul class="articles"><li class="open chapter"data-level="1.1.1.2.1"data-path="lifecycle.en.html"><a href="lifecycle.en.html">Lifecycle</a></li><li class="open chapter"data-level="1.1.1.2.2"data-path="page-style-and-layout.en.html"><a href="page-style-and-layout.en.html">Page style and layout</a></li><li class="open chapter"data-level="1.1.1.2.3"data-path="framework-instructions.en.html"><a href="framework-instructions.en.html">Framework commands</a></li><li class="open chapter"data-level="1.1.1.2.4"data-path="switching-pages-and-passing-parameters.en.html"><a href="switching-pages-and-passing-parameters.en.html">Switching pages and passing parameters</a></li><li class="open chapter"data-level="1.1.1.2.5"data-path="event-monitoring-and-triggering.en.html"><a href="event-monitoring-and-triggering.en.html">Event monitoring and triggering</a></li><li class="open chapter"data-level="1.1.1.2.6"data-path="parent-child-component-communication.en.html"><a href="parent-child-component-communication.en.html">Parent-child component communication</a></li><li class="open open chapter active"data-level="1.1.1.2.7"data-path="using-async.en.html"><a href="using-async.en.html">Using async</a></li></ul></li><li class="open chapter"data-level="1.1.1.3"data-path="../widgets/index.en.md"><a href="javascript:;">Widgets <span class="icon icon-arrow"></span></a><ul class="articles"><li class="open chapter"data-level="1.1.1.3.1"data-path="../widgets/list-tutorial.en.html"><a href="../widgets/list-tutorial.en.html">List tutorial</a></li></ul></li></ul></nav><div class="doc-content"><div class="doc-content-inner"><div class="page-inner"><div id="book-search-results"><div class="search-noresults"><section class="markdown-section normal"><a href="#using-async"id="anchorNavigationExGoTop"><i class="fa fa-arrow-up"></i></a><h1 id="using-async"><a href="#using-async"class="anchor-navigation-ex-anchor"name="using-async"><i class="fa fa-link"aria-hidden="true"></i></a>Using async</h1><blockquote><p>Learn how to use <code>async</code> syntax to develop your app, and replace Callback and Promise in a more neat and elegant way.</p></blockquote><p>Here's what you'll be able to do after reading:</p><ul><li>How to configure <code>async</code> syntax's babel compilation support</li><li>Use <code>async</code> and <code>await</code> syntax</li><li>Use <code>async</code> in the native interface</li></ul><blockquote><p>You can find the code described in this tutorial here: app.ux in the src/Async directory</p></blockquote><h2 id="how-to-configure-async-syntaxs-babel-compilation-support"><a href="#how-to-configure-async-syntaxs-babel-compilation-support"class="anchor-navigation-ex-anchor"name="how-to-configure-async-syntaxs-babel-compilation-support"><i class="fa fa-link"aria-hidden="true"></i></a>How to configure async syntax's babel compilation support</h2><p>In the traditional front-end development, async processing methods include Callback, Promise, and Generator. Among them, the latter method tends to be much more readable than the former; the new syntax of <code>async</code> in the ECMA specification can handle asynchronous situations in a more elegant way.</p><p>Current app platform itself only supports the <code>ES5</code> syntax. In order to use it, you need to have syntax analysis and conversion tools, for example <code>babel</code>, as well as inject <code>polyfill</code> into the code.</p><p>Developers should inject <code>babel-runtime/regenerator</code> into <code>app.ux</code>, because this file should be executed before all the page scripts are executed, as shown in the following code:</p><pre><code>// Script: regenerator.js
// Global reference
const globalRef = global.__proto__ || global

// global injection regeneratorRuntime
globalRef.regeneratorRuntime = require('babel-runtime/regenerator')
</code></pre><p>By introducing this script in <code>app.ux</code>, you can inject the support to <code>async</code>. Search for <code>regeneratorRuntime</code> in the <code>build/app.js</code> after the project has been compiled, you will find that it has been injected successfully.</p><p><strong>Attention: This feature is only supported on aiot-toolkit version 24 or later (because it's required to add library dependencies and modify compilation options)</strong></p><h2 id="use-async-and-await-syntax"><a href="#use-async-and-await-syntax"class="anchor-navigation-ex-anchor"name="use-async-and-await-syntax"><i class="fa fa-link"aria-hidden="true"></i></a>Use async and await syntax</h2><p>For syntax, you can refer to the book called <a href="http://exploringjs.com/es2016-es2017/ch_async-functions.html"target="_blank">Exploring ES2016 and ES2017</a> and other available materials.</p><p>Add the following code to the tutorial</p><pre><code>&lt;template>
&lt;/template>

&lt;style lang="less">
&lt;/style>

&lt;script>
  export default {
    data: {
    },
    onInit () {
      this.$page.setTitleBar({ text: 'supports AsyncAwait' })
    },
    onReady () {
      this.testAsync()
    },
    /**
     * Test Async
     */
    testAsync () {
      async function bar () {
        return 'bar'
      }
      async function foo() {
        const ret1 = await bar();
        console.info('PAGE: foo: ', ret1)
      }
      foo()
    }
  }
&lt;/script>
</code></pre><h2 id="use-async-in-the-native-interface"><a href="#use-async-in-the-native-interface"class="anchor-navigation-ex-anchor"name="use-async-in-the-native-interface"><i class="fa fa-link"aria-hidden="true"></i></a>Use async in the native interface</h2><p>To use the native interface with the help of <code>async</code>, you need to transform the native interface from <code>callback</code> to <code>Promise</code>, and define <code>async</code> to return at the same time.</p><p>The following example describes the transformation of the fetch interface and exposes it to the <code>global</code> environment.</p><pre><code>// asyncNatives.js
import nativeFetch from '@system.fetch'

const natives = {
  /**
   * Network request
   * @param options
   * @return {Promise}
   */
  async fetch (options) {
    const p1 = new Promise((resolve, reject) => {
      options.success = function (data, code) {
        resolve({ data, code })
      }
      options.fail = function (data, code) {
        resolve({ data, code })
      }
      nativeFetch.fetch(options)
    })
    return p1
  }
}

//Add tp global environment
const hookTo = global.__proto__ || global
hookTo.natives = natives

export default natives
</code></pre><p>Execute the above code first, and expose the <code>natives</code> global variable, so the following code can cite the object, which describes how to call the Fetch interface of <code>async</code>.</p><pre><code>&lt;template>
&lt;/template>

&lt;style lang="less">
&lt;/style>

&lt;script>
  export default {
    data: {
    },
    onInit () {
      this.$page.setTitleBar({ text: 'Support AsyncAwait' })
    },
    onReady () {
      this.testNatives()
    },
    /**
     * Test async's native interface
     */
    async testNatives () {
      // Success
      const ret1 = await natives.fetch({
        url: 'https://gss0.bdstatic.com/5bd1bjqh_Q23odCf/static/itemrep/bottomBanner/index_9e10f91.js',
      })
      console.info('fetchSuccess result: ', JSON.stringify(ret1))
      // Fail
      const ret2 = await natives.fetch({
        url: 'https://gss0.bdstatic.com/xxxxx'
      })
      console.info('fetchFailure result: ', JSON.stringify(ret2))
    }
  }
&lt;/script>
</code></pre><h2 id="summary"><a href="#summary"class="anchor-navigation-ex-anchor"name="summary"><i class="fa fa-link"aria-hidden="true"></i></a>Summary</h2><p>This section isn't a necessary part of development, but provides developers with a more elegant approach for async processing. Learn and use it if you're interested.</p></section></div><div class="search-results"><div class="has-results"><h1 class="search-results-title"><span class="search-results-count"></span> 条匹配 "<span class="search-query"></span>" 的结果</h1><ul class="search-results-list"></ul></div><div class="no-results"><h1 class="search-results-title">没有搜索到与 "<span class="search-query"></span>" 相关的内容</h1></div></div></div></div></div><a href="parent-child-component-communication.en.html"class="navigation navigation-prev"aria-label="Previous page: Parent-child component communication"><i class="fa fa-angle-left"></i> </a><a href="../widgets/index.en.md"class="navigation navigation-next"aria-label="Next page: Widgets"><i class="fa fa-angle-right"></i></a></div></div><script src="../../gitbook/gitbook.js"></script><script src="../../gitbook/gitbook-plugin-hap-util/plugin.js"></script><script src="../../gitbook/gitbook-plugin-nocache/nocache.js"></script><script src="../../gitbook/gitbook-plugin-search-pro/jquery.mark.min.js"></script><script src="../../gitbook/gitbook-plugin-search-pro/search.js"></script><script>gitbook.page.hasChanged({page:{title:"Using async",level:"1.1.1.2.7",depth:4,next:{title:"Widgets",level:"1.1.1.3",depth:3,path:"tutorial/widgets/index.en.md",ref:"tutorial/widgets/index.en.md",articles:[{title:"List tutorial",level:"1.1.1.3.1",depth:4,path:"tutorial/widgets/list-tutorial.en.md",ref:"tutorial/widgets/list-tutorial.en.md",articles:[]}]},previous:{title:"Parent-child component communication",level:"1.1.1.2.6",depth:4,path:"tutorial/framework/parent-child-component-communication.en.md",ref:"tutorial/framework/parent-child-component-communication.en.md",articles:[]},dir:"ltr"},config:{plugins:["html-minifier","-sharing","-fontsettings","hap-util","favicon","theme-default","nocache","-lunr","-search","search-pro","-highlight","highlight-hap","anchor-navigation-ex"],styles:{website:"styles/website.css"},pluginsConfig:{favicon:{shortcut:"",bookmark:""},"html-minifier":{customAttrSurround:[],removeScriptTypeAttributes:!1,removeEmptyAttributes:!1,removeRedundantAttributes:!1,removeEmptyElements:!1,sortClassName:!0,caseSensitive:!0,html5:!0,collapseWhitespace:!0,processConditionalComments:!1,quoteCharacter:null,keepClosingSlash:!0,preventAttributesEscaping:!1,minifyURLs:!1,removeAttributeQuotes:!1,decodeEntities:!0,trimCustomFragments:!1,customAttrAssign:[],includeAutoGeneratedTags:!0,collapseInlineTagWhitespace:!1,collapseBooleanAttributes:!0,minifyJS:!0,removeTagWhitespace:!0,preserveLineBreaks:!1,sortAttributes:!0,removeStyleLinkTypeAttributes:!1,removeComments:!0,minifyCSS:!0,processScripts:[],conservativeCollapse:!1,removeOptionalTags:!1,useShortDoctype:!1},"anchor-navigation-ex":{associatedWithSummary:!1,float:{floatIcon:"fa fa-navicon",level1Icon:"",level2Icon:"",level3Icon:"",showLevelIcon:!1},mode:"",multipleH1:!0,pageTop:{level1Icon:"",level2Icon:"",level3Icon:"",showLevelIcon:!1},printLog:!1,showGoTop:!0,showLevel:!1},"hap-util":{},nocache:{},"search-pro":{},"highlight-hap":{},"theme-default":{showLevel:!1,styles:{ebook:"styles/ebook.css",epub:"styles/epub.css",mobi:"styles/mobi.css",pdf:"styles/pdf.css",print:"styles/print.css",website:"styles/website.css"}}},theme:"default",author:"QuickApp.cn",pdf:{pageNumbers:!0,fontSize:12,fontFamily:"Arial",paperSize:"a4",chapterMark:"pagebreak",pageBreaksBefore:"/",margin:{right:62,left:62,top:56,bottom:56}},structure:{langs:"LANGS.md",readme:"README.md",glossary:"GLOSSARY.md",summary:"SUMMARY.md"},variables:{},version:"{{datetime}}",title:"快应用开发文档",language:"zh-hans",gitbook:"3.2.3",description:"快应用的开发文档，供快应用开发者学习和参考"},file:{path:"tutorial/framework/using-async.en.md",mtime:"2021-09-14T04:27:18.384Z",type:"markdown"},gitbook:{version:"3.2.3",time:"2021-09-22T03:43:40.422Z"},basePath:"../..",book:{language:""}}),function(){var e=location.pathname.split("/")[1];e!=(sessionStorage.getItem("indexTab")||"")&&sessionStorage.setItem("mst",0),~location.pathname.indexOf(".html")||sessionStorage.setItem("mst",0),sessionStorage.setItem("indexTab",e);var t=$(".doc-menu"),s=$(".summary");if(!(t.height()>s.height()&&0!==s.height())){t.scroll(function(){sessionStorage.setItem("mst",t.scrollTop())});var a=sessionStorage.getItem("mst")||0;t.scrollTop(a),$("ul.summary li").each(function(){var e=$(this);10<e.data("level").length&&(e.hasClass("active")?e.parent().parent().attr("class","open chapter cur"):e.parent().parent().siblings().each(function(){var e=$(this);!e.hasClass("cur")&&e.hasClass("open chapter")&&e.attr("class","chapter")}))})}}()</script></body></html>